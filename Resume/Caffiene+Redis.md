# 热门商品榜单(Two-Level Cache)
## Situation
* 为商城提供一个“热门榜单”的API。要求根据自定义的榜单权重计算的算法，定期自动更新前5名热销产品的信息, 并且要求根据接收到的不同的商品类型维护不同的榜单
* 因为主要是面对B2B企业硬件采购，在采购季节会有比较频繁的使用热门榜单功能进行查询

## Task
* 我主要负责实现这个“热门榜单”的api

## Action
* 前期，在拿到任务需求后我主动与manger和开了多次会议，从功能的性能，使用场景，具体的效果进行了充分的讨论。
  * 通过讨论明确了热门榜单功能 1.实时性要求不高，能够接受延迟 2.更新频率不高 3. 要求做到高峰时期能狗应对频繁访问 
  * 针对这个特点，我提出了可以使用Caffiene + Redis 二级缓存的方法来提高访问效率
  * 与单独的Redis分布式缓存不同， 多加入的Caffiene是本地缓存，基于本地存储，查询速度很快，可以极大减少网络的I/O, 降低网络的消耗

* 然后，我展示了 two-level Cache的流程图
  * 【图】
  * 具体来说就是，每次通过 商品类型 点击 热门榜单 按钮的时候，会发出请求，首先会查询一级缓存，也就是caffiene, 如果存在，就返回
  * 如果不存在就查询二级缓存，也就是redis层，如果存在就返回，如果没有就 查询数据库
  * 然后数据库查询到的榜单结果写入缓存，并且通过kafka进行消息发送，异步删除所有的缓存，并且存入新的缓存 
* 通过讨论，发现这种方法虽然 

* 查询预计送达时间的接口
* 根据 商品的类别 + 城市 + 仓库 快速查询预计送达时间
* 商城下单就会调用这个接口
